#########################################################################
#                                                                       #
# Name: Haproxy.cfg                                                     #
#                                                                       #
# Autor: Ivo Rodrigues (ivorodriguesvieira@gmail.com)                   #
# Template Date: 2023/03/11                                             #
# Config developed for Centos7                                          #
# Template Version: 2.2                                                 #    
# Deploy by Ansible AWX                                                 #
#                                                                       #
# Description: Configuration file                                       #
#                                                                       #
# How to use: 1) Copy the file to /etc/haproxy.                         #
#             2) Then check that all DNS entries are correct.           #
#             3) Restart the service: "systemctl restart haproxy"       #
#             4) Access the URL: https://IP_BIND_ADRESS:1936/stats      #
#                                                                       #
# Note:  When you have multiple Haproxys, Keepalived is usually used.   #
#        Read the Read the README.MD                                    #
#        to know the changes made in the current version.               #
#                                                                       #
#########################################################################

######################### Global Configuration ##########################
global
   log /dev/log local0 
   log /dev/log local1 debug 
   chroot /var/lib/haproxy
   stats socket *:1999 level admin
   stats socket /var/run/haproxy.sock mode 600 level admin
   server-state-file /etc/haproxy/haproxy.state
   maxconn 2000000
   user haproxy
   group haproxy
   daemon
#########################################################################

######################### Default Configuration #########################
defaults
   log global
   mode http
   maxconn 2000000
   load-server-state-from-file global
   option dontlognull
   timeout connect 3s
   timeout client 30s
   timeout server 30s
#########################################################################

######################### Onlinehelp IIS configuration #########################   
frontend fe_iis_app1
   bind ap-app-iis.domain.local:8090
   mode http
   maxconn 2000000
   acl ip_24 src 10.24.0.0/16
   acl ip_25 src 10.25.0.0/16
   use_backend be24_iis_app1 if ip_24 
   use_backend be25_iis_app1 if ip_25
   default_backend be24_iis_app1

backend be24_iis_app1
   mode http
   option forwardfor
   option httpchk GET /
   server iis-onlinehelp-01 app-app1.domain.local:8090 check 
   server iis-onlinehelp-02 app-app2.domain.local:8090 check  
   server iis-onlinehelp-01 app-app1.domain.local:8090 check backup
   server iis-onlinehelp-02 app-app2.domain.local:8090 check backup

backend be25_iis_app1
   mode http
   option forwardfor
   option httpchk GET / 
   server iis-onlinehelp-01 app-app1.domain.local:8090 check
   server iis-onlinehelp-02 app-app2.domain.local:8090 check
   server iis-onlinehelp-01 app-app1.domain.local:8090 check backup
   server iis-onlinehelp-02 app-app2.domain.local:8090 check backup
##########################################################################

######################### RD Web Configuration ##########################
frontend fe_https_rds
	bind atls.domain.local:443
	mode tcp
	acl ip_24 src 10.24.0.0/16
    acl ip_25 src 10.25.0.0/16
    use_backend be24_https_rds if ip_24 
    use_backend be25_https_rds if ip_25
	timeout client 6h
	log global
	option tcplog
	default_backend be24_https_rds
 
backend be24_https_rds
	mode tcp
	timeout server 6h
	balance roundrobin
	log global
	option tcplog
	option tcp-check
	server dz1-atls1 dz1-atls1.domain.local:443 check
	server dz1-atls2 dz1-atls1.domain.local:443 check
	server dz1-atls1 dz1-atls1.domain.local:443 check backup
	server dz1-atls2 dz1-atls2.domain.local:443 check backup

backend be25_https_rds
	mode tcp
	timeout server 6h
	balance roundrobin
	log global
	option tcplog
	option tcp-check
	server dz1-atls1 dz1-atls1.domain.local:443 check 
	server dz1-atls2 dz1-atls2.domain.local:443 check	
	server dz1-atls1 dz1-atls1.domain.local:443 check backup
	server dz1-atls2 dz1-atls2.domain.local:443 check backup

#########################################################################


######################### RDP Remote app config #########################
frontend fe_rdp
	bind atls.domain.local:3389 name rdp
	mode tcp
	acl ip_24 src 10.24.0.0/16
    acl ip_25 src 10.25.0.0/16
    use_backend be24_rdp if ip_24 
    use_backend be25_rdp if ip_25
	timeout client 1h
	log global
	option tcplog
	tcp-request inspect-delay 2s
	tcp-request content accept if RDP_COOKIE
	default_backend be24_rdp
 
backend be24_rdp
	mode tcp
	balance leastconn
	timeout server 1h
	timeout connect 4s
	log global
	option tcplog
	stick-table type string len 32 size 10k expire 8h 
	stick on rdp_cookie(mstshash)
	option tcp-check
	default-server inter 3s rise 2 fall 3
	server dz1-atls1 dz1-atls1.domain.local:3389 weight 10 check 
	server dz1-atls2 dz1-atls2.domain.local:3389 weight 10 check 
	server dz1-atls1 dz1-atls1.domain.local:3389 weight 10 check backup 
	server dz1-atls2 dz1-atls2.domain.local:3389 weight 10 check backup 

backend be25_rdp
	mode tcp
	balance leastconn
	timeout server 1h
	timeout connect 4s
	log global
	option tcplog
	stick-table type string len 32 size 10k expire 8h 
	stick on rdp_cookie(mstshash)
	option tcp-check
	default-server inter 3s rise 2 fall 3
	server dz1-atls1 dz1-atls1.domain.local:3389 weight 10 check 
	server dz1-atls2 dz1-atls2.domain.local:3389 weight 10 check 
	server dz1-atls1 dz1-atls1.domain.local:3389 weight 10 check backup 
	server dz1-atls2 dz1-atls2.domain.local:3389 weight 10 check backup	
############################################################################

######################### Configuration Zabbix database #################
frontend fe_zdb_cluster
    bind ap-dci-zdb.domain.local:3306
    mode tcp
    option tcplog
    default_backend be_zdb_cluster

backend be_zdb_cluster
    mode tcp
    option tcpka
	stick on dst
    stick-table type ip size 1000
	timeout client 90m
    timeout server 90m
    balance leastconn
    server zabbix-database-01 dci-zdb.domain.local:3306 check weight 1
    server zabbix-database-02 dci-zdb.domain.local:3306 check backup weight 2		
#########################################################################

######################### MQTT configuration ############################
frontend fe_dci_mqtt
  bind ap-dci-mqtt.domain.local:1883
  mode tcp
  maxconn 2000000
  timeout client 130s
  acl ip_24 src 10.24.0.0/16
  acl ip_25 src 10.25.0.0/16
  option tcplog
  use_backend be24_dci_mqtt if ip_24 
  use_backend be25_dci_mqtt if ip_25
  default_backend be24_dci_mqtt

backend be24_dci_mqtt
   mode tcp
   balance source
   option clitcpka
   option log-health-checks
   option redispatch
   timeout connect 3s
   timeout server 130s
   option tcplog
   server dci-mqtt1 dci-mqtt1.domain.local:1883 check port 1883 fall 15
   server dci-mqtt2 dci-mqtt2.domain.local:1883 check port 1883 fall 15
   server dci-mqtt1 dci-mqtt1.domain.local:1883 check backup port 1883 fall 15
   server dci-mqtt2 dci-mqtt2.domain.local:1883 check backup port 1883 fall 15

backend be25_dci_mqtt
   mode tcp
   balance source
   option clitcpka
   option log-health-checks
   option redispatch
   timeout connect 3s
   timeout server 130s
   option tcplog
   server dci-mqtt1 dci-mqtt1.domain.local:1883 check port 1883 fall 15
   server dci-mqtt2 dci-mqtt2.domain.local:1883 check port 1883 fall 15
   server dci-mqtt1 dci-mqtt1.domain.local:1883 check backup port 1883 fall 15
   server dci-mqtt2 dci-mqtt2.domain.local:1883 check backup port 1883 fall 15
###################################################################################

######################### HDR configuration #########################
frontend fe_hdr
   bind ap-ms-app.domain.local:5601
   mode http
   maxconn 2000000
   acl ip_24 src 10.24.0.0/16
   acl ip_25 src 10.25.0.0/16
   use_backend be24_hdr if ip_24 
   use_backend be25_hdr if ip_25
   default_backend be24_hdr

backend be24_hdr
   mode http
   option forwardfor
   option httpchk GET /api/status
   server hdr-01 ms-app1.domain.local:5601 check
   server hdr-02 ms-app2.domain.local:5601 check
   server hdr-01 ms-app1.domain.local:5601 check backup
   server hdr-02 ms-app2.domain.local:5601 check backup

backend be25_hdr
   mode http
   option forwardfor
   option httpchk GET /api/status
   server hdr-01 ms-app1.domain.local:5601 check
   server hdr-02 ms-app2.domain.local:5601 check
   server hdr-01 ms-app1.domain.local:5601 check backup
   server hdr-02 ms-app2.domain.local:5601 check backup
##########################################################################

######################### FRAS IIS configuration #########################   
frontend fe_iis_fras
   bind ap-ms-iis.domain.local:8081
   mode http
   maxconn 2000000
   acl ip_24 src 10.24.0.0/16
   acl ip_25 src 10.25.0.0/16
   use_backend be24_iis_fras if ip_24 
   use_backend be25_iis_fras if ip_25
   default_backend be24_iis_fras

backend be24_iis_fras
   mode http
   option forwardfor
   option httpchk GET /FRAS/RuleTemplate?id= 
   server iis-fras-01 ms-app1.domain.local:8081 check 
   server iis-fras-02 ms-app2.domain.local:8081 check  
   server iis-fras-01 ms-app1.domain.local:8081 check backup
   server iis-fras-02 ms-app2.domain.local:8081 check backup

backend be25_iis_fras
   mode http
   option forwardfor
   option httpchk GET /FRAS/RuleTemplate?id=  
   server iis-fras-01 ms-app1.domain.local:8081 check
   server iis-fras-02 ms-app2.domain.local:8081 check
   server iis-fras-01 ms-app1.domain.local:8081 check backup
   server iis-fras-02 ms-app2.domain.local:8081 check backup
##########################################################################

######################### FRAS APP configuration #########################
frontend fe_app_fras
   bind ap-ms-app.domain.local:9081
   mode http
   maxconn 2000000
   acl ip_24 src 10.24.0.0/16
   acl ip_25 src 10.25.0.0/16
   use_backend be24_app_fras if ip_24 
   use_backend be25_app_fras if ip_25
   default_backend be24_app_fras

backend be24_app_fras
   mode http
   option forwardfor
   option httpchk GET /FRASRootCauseAnalysisService 
   http-check expect status 400
   server fras-01 ms-app1.domain.local:9081 check 
   server fras-02 ms-app2.domain.local:9081 check 
   server fras-01 ms-app1.domain.local:9081 check backup
   server fras-02 ms-app2.domain.local:9081 check backup  

backend be25_app_fras
   mode http
   option forwardfor
   option httpchk GET /FRASRootCauseAnalysisService
   http-check expect status 400
   server fras-01 ms-app1.domain.local:9081 check
   server fras-02 ms-app2.domain.local:9081 check
   server fras-01 ms-app1.domain.local:9081 check backup
   server fras-02 ms-app2.domain.local:9081 check backup
#########################################################################

######################### DDA IIS configuration #########################
frontend fe_iis_dda
   bind ap-ms-iis.domain.local:8082
   mode http
   maxconn 2000000
   acl ip_24 src 10.24.0.0/16
   acl ip_25 src 10.25.0.0/16
   use_backend be24_iis_dda if ip_24 
   use_backend be25_iis_dda if ip_25
   default_backend be24_iis_dda

backend be24_iis_dda
   mode http
   option forwardfor
   option httpchk GET /DDA/Equipment HTTP/1.1 
   http-check expect status 400 
   server iis-dda-01 ms-app1.domain.local:8082 check
   server iis-dda-02 ms-app2.domain.local:8082 check
   server iis-dda-01 ms-app1.domain.local:8082 check backup
   server iis-dda-02 ms-app2.domain.local:8082 check backup

backend be25_iis_dda
   mode http
   option forwardfor
   option httpchk GET /DDA/Equipment HTTP/1.1
   http-check expect status 400 
   server iis-dda-01 ms-app1.domain.local:8082 check 
   server iis-dda-02 ms-app2.domain.local:8082 check 
   server iis-dda-01 ms-app1.domain.local:8082 check backup
   server iis-dda-02 ms-app2.domain.local:8082 check backup
#########################################################################

######################### DDA APP configuration #########################
frontend fe_app_dda
   bind ap-ms-app.domain.local:9082
   mode http
   maxconn 2000000
   acl ip_24 src 10.24.0.0/16
   acl ip_25 src 10.25.0.0/16
   use_backend be24_app_dda if ip_24 
   use_backend be25_app_dda if ip_25
   default_backend be24_app_dda

backend be24_app_dda
   mode http
   option forwardfor
   option httpchk GET /DDAManagerService
   http-check expect status 400 
   server dda-01 ms-app1.domain.local:9082 check
   server dda-02 ms-app2.domain.local:9082 check
   server dda-01 ms-app1.domain.local:9082 check backup
   server dda-02 ms-app2.domain.local:9082 check backup

backend be25_app_dda
   mode http
   option forwardfor
   option httpchk GET /DDAManagerService 
   http-check expect status 400
   server dda-01 ms-app1.domain.local:9082 check 
   server dda-02 ms-app2.domain.local:9082 check 
   server dda-01 ms-app1.domain.local:9082 check backup
   server dda-02 ms-app2.domain.local:9082 check backup
#######################################################################

######################### RSS IIS configuration #########################
frontend fe_iis_rss
   bind ap-ms-iis.domain.local:8085
   mode http
   maxconn 2000000
   acl ip_24 src 10.24.0.0/16
   acl ip_25 src 10.25.0.0/16
   use_backend be24_iis_rss if ip_24 
   use_backend be25_iis_rss if ip_25
   default_backend be24_iis_rss

backend be24_iis_rss
   mode http
   option forwardfor
   option httpchk GET /RSSWEB HTTP/1.1 
   http-check expect status 400 
   server iis-rss-01 ms-app1.domain.local:8085 check
   server iis-rss-02 ms-app2.domain.local:8085 check
   server iis-rss-01 ms-app1.domain.local:8085 check backup
   server iis-rss-02 ms-app2.domain.local:8085 check backup

backend be25_iis_rss
   mode http
   option forwardfor
   option httpchk GET /RSSWEB HTTP/1.1
   http-check expect status 400 
   server iis-rss-01 ms-app1.domain.local:8085 check 
   server iis-rss-02 ms-app2.domain.local:8085 check 
   server iis-rss-01 ms-app1.domain.local:8085 check backup
   server iis-rss-02 ms-app2.domain.local:8085 check backup
#########################################################################

######################### RSS MS APP configuration #########################
frontend fe_ms_rss
   bind ap-ms-app.domain.local:9085
   mode http
   maxconn 2000000
   acl ip_24 src 10.24.0.0/16
   acl ip_25 src 10.25.0.0/16
   use_backend be24_ms_rss if ip_24 
   use_backend be25_ms_rss if ip_25
   default_backend be24_ms_rss

backend be24_ms_rss
   mode http
   option forwardfor
   option httpchk GET /RSSmanagerservice HTTP/1.1 
   http-check expect status 400 
   server ms-rss-01 ms-app1.domain.local:9085 check
   server ms-rss-02 ms-app2.domain.local:9085 check
   server ms-rss-01 ms-app1.domain.local:9085 check backup
   server ms-rss-02 ms-app2.domain.local:9085 check backup

backend be25_ms_rss
   mode http
   option forwardfor
   option httpchk GET /RSSmanagerservice HTTP/1.1
   http-check expect status 400 
   server ms-dda-01 ms-app1.domain.local:9085 check 
   server ms-dda-02 ms-app2.domain.local:9085 check 
   server ms-dda-01 ms-app1.domain.local:9085 check backup
   server ms-dda-02 ms-app2.domain.local:9085 check backup
#########################################################################


######################### OFbiz configuration #########################
frontend fe_ofbiz
   bind ap-ms-mms.domain.local:8443
   mode tcp
   maxconn 2000000
   acl ip_24 src 10.24.0.0/16
   acl ip_25 src 10.25.0.0/16
   use_backend be24_ofbiz if ip_24 
   use_backend be25_ofbiz if ip_25
   default_backend be24_ofbiz

backend be24_ofbiz
   mode tcp
   option ssl-hello-chk
   balance source
   stick-table type ip size 200k expire 30m
   stick on src
   default-server inter 3s
   server ofbiz-01 ms-mms1.domain.local:8443 check id 1
   server ofbiz-02 ms-mms2.domain.local:8443 check id 2
   server ofbiz-01 ms-mms1.domain.local:8443 check id 3 backup
   server ofbiz-02 ms-mms2.domain.local:8443 check id 4 backup

backend be25_ofbiz
   mode tcp
   option ssl-hello-chk
   balance source
   stick-table type ip size 200k expire 30m
   stick on src
   default-server inter 3s
   server ofbiz-01 ms-mms1.domain.local:8443 check id 1
   server ofbiz-02 ms-mms2.domain.local:8443 check id 2
   server ofbiz-01 ms-mms1.domain.local:8443 check id 3 backup
   server ofbiz-02 ms-mms2.domain.local:8443 check id 4 backup
###################################################################################

######################### app Security Server configuration #######################
frontend fe_app_ss
   bind ap-app-ss.domain.local:443
   mode tcp
   http-request set-header X-Forwarded-Proto https
   acl sslv3 req.ssl_ver 3
   tcp-request inspect-delay 2s
   tcp-request content reject if sslv3
   maxconn 2000000
   acl ip_24 src 10.24.0.0/16
   acl ip_25 src 10.25.0.0/16
   use_backend be24_app_ss if ip_24 
   use_backend be25_app_ss if ip_25
   default_backend be24_app_ss

backend be24_app_ss
   mode tcp 
   balance source
   option ssl-hello-chk
   option forwardfor
   #option httpchk GET /Framework.Security.Web.AlsSecurityService.svc
   server app-ss1 app-ss1.domain.local:443 check 
   server app-ss2 app-ss2.domain.local:443 check
   server app-ss1 app-ss1.domain.local:443 check backup
   server app-ss2 app-ss2.domain.local:443 check backup

backend be25_app_ss
   mode tcp 
   balance source
   option ssl-hello-chk
   option forwardfor
   #option httpchk GET /Framework.Security.Web.AlsSecurityService.svc
   server app-ss1 app-ss1.domain.local:443 check
   server app-ss2 app-ss2.domain.local:443 check
   server app-ss1 app-ss1.domain.local:443 check backup
   server app-ss2 app-ss2.domain.local:443 check backup
#######################################################################

######################### CS AM configuration #########################   
frontend fe_cs_am
   bind ap-am.domain.local:9091
   mode tcp
   maxconn 2000000
   acl ip_24 src 10.24.0.0/16
   acl ip_25 src 10.25.0.0/16
   use_backend be24_cs_am if ip_24 
   use_backend be25_cs_am if ip_25
   default_backend be24_cs_am   

backend be24_cs_am
   balance source
   mode tcp
   option forwardfor
   #http-check expect status 302
   #option httpchk GET /DBService "HTTP/1.1\r\nHost: ap-am.domain.local"
   server am am.domain.local:9091 check inter 2s weight 1
   server am am.domain.local:9091 check backup inter 2s weight 2

backend be25_cs_am
   balance source
   mode tcp
   option forwardfor
   #http-check expect status 302
   #option httpchk GET /DBService "HTTP/1.1\r\nHost: ap-am.domain.local"
   server am am.domain.local:9091 check inter 2s weight 1
   server am am.domain.local:9091 check backup inter 2s weight 2
###################################################################################

######################### SMTP TLS configuration #########################   
frontend fe_tls_smtp
  bind smtp.domain.local:465
  mode tcp 
   acl ip_24 src 10.24.0.0/16
   acl ip_25 src 10.25.0.0/16
   use_backend be24_tls_smtp if ip_24
   use_backend be25_tls_smtp if ip_25
   default_backend be24_tls_smtp

backend be24_tls_smtp
   mode tcp
   balance source
   stick-table type ip size 200k expire 30m
   stick on src
   default-server inter 3s
   server dz1-edg1-smtp dz1-edg1.domain.local:465 check id 1
   server dz1-edg2-smtp  dz1-edg2.domain.local:465 check id 2
   server dz1-edg1-smtp  dz1-edg1.domain.local:465 check id 3 backup
   server dz1-edg2-smtp  dz1-edg2.domain.local:465 check id 4 backup

backend be25_tls_smtp
   mode tcp
   balance source
   stick-table type ip size 200k expire 30m
   stick on src
   default-server inter 3s
   server dz1-edg1-smtp  dz1-edg1.domain.local:465 check id 1
   server dz1-edg2-smtp  dz1-edg2.domain.local:465 check id 2
   server dz1-edg1-smtp  dz1-edg1.domain.local:465 check id 3 backup
   server dz1-edg2-smtp  dz1-edg2.domain.local:465 check id 4 backup
##########################################################################

######################### Uniprint configuration #########################  
frontend fe_dz1_uniprint
  bind uniprint.domain.local:999
  mode tcp 
   acl ip_24 src 10.24.0.0/16
   acl ip_25 src 10.25.0.0/16
   use_backend be24_dz1_uniprint if ip_24
   use_backend be25_dz1_uniprint if ip_25
   default_backend be24_dz1_uniprint

backend be24_dz1_uniprint
   mode tcp
   balance source
   stick-table type ip size 200k expire 30m
   stick on src
   default-server inter 3s
   server dz1-edg1-uniprint dz1-edg1.domain.local:999 check id 1
   server dz1-edg2-uniprint dz1-edg2.domain.local:999 check id 2
   server dz1-edg1-uniprint dz1-edg1.domain.local:999 check id 3 backup
   server dz1-edg2-uniprint dz1-edg2.domain.local:999 check id 4 backup

backend be25_dz1_uniprint
   mode tcp
   balance source
   stick-table type ip size 200k expire 30m
   stick on src
   default-server inter 3s
   server dz1-edg1-uniprint dz1-edg1.domain.local:999 check id 1
   server dz1-edg2-uniprint dz1-edg2.domain.local:999 check id 2
   server dz1-edg1-uniprint dz1-edg1.domain.local:999 check id 3 backup
   server dz1-edg2-uniprint dz1-edg2.domain.local:999 check id 4 backup
############################################################################

######################### PrintServers configuration #######################  
frontend fe_dz1_printserver
  bind uniprint.domain.local:445
  bind uniprint.domain.local:1024-2000
  mode tcp 
   acl ip_24 src 10.24.0.0/16
   acl ip_25 src 10.25.0.0/16
   use_backend be24_dz1_printserver if ip_24
   use_backend be25_dz1_printserver if ip_25
   default_backend be24_dz1_printserver

backend be24_dz1_printserver
   mode tcp
   balance source
   server dz1-edg1-printserver dz1-edg1.domain.local:445 check id 1
   server dz1-edg2-printserver dz1-edg2.domain.local:445 check id 2
   server dz1-edg1-printserver dz1-edg1.domain.local:445 check id 3 backup
   server dz1-edg2-printserver dz1-edg2.domain.local:445 check id 4 backup

backend be25_dz1_printserver
   mode tcp
   balance source
   server dz1-edg1-printserver dz1-edg1.domain.local:445 check id 1
   server dz1-edg2-printserver dz1-edg2.domain.local:445 check id 2
   server dz1-edg1-printserver dz1-edg1.domain.local:445 check id 3 backup
   server dz1-edg2-printserver dz1-edg2.domain.local:445 check id 4 backup
############################################################################
   
######################### app IIS configuration #########################
frontend fe_iis_app
   bind ap-app-iis.domain.local:8080
   mode tcp
   maxconn 2000000
   timeout client 3s
   acl ip_24 src 10.24.0.0/16
   acl ip_25 src 10.25.0.0/16
   use_backend be24_iis_app if ip_24 
   use_backend be25_iis_app if ip_25
   default_backend be24_iis_app

backend be24_iis_app
   balance source 
   mode http 
   option forwardfor
   http-check expect status 200
   option httpchk GET /SystemParametersConfiguration.html
   server iis-app-app1 app-app1.domain.local:8080 check inter 3s weight 1
   server iis-app-app2 app-app2.domain.local:8080 check inter 3s weight 2
   server iis-app-app1 app-app1.domain.local:8080 check backup inter 3s weight 3
   server iis-app-app2 app-app2.domain.local:8080 check backup inter 3s weight 4

backend be25_iis_app
   balance source
   mode http
   option forwardfor     
   http-check expect status 200
   option httpchk GET /SystemParametersConfiguration.html
   server iis-app-app1 app-app1.domain.local:8080 check inter 3s weight 1
   server iis-app-app2 app-app2.domain.local:8080 check inter 3s weight 2
   server iis-app-app1 app-app1.domain.local:8080 check backup inter 3s weight 3
   server iis-app-app2 app-app2.domain.local:8080 check backup inter 3s weight 4
######################################################################### 

######################### app APP configuration #########################
frontend fe_app_app
   bind ap-app-app.domain.local:9080
   mode http 
   maxconn 2000000
   timeout client 3s
   acl config_system url_beg -i /systemConfigurationService  
   acl config_logging url_beg -i /LoggingService
   acl config_diagnostics url_beg -i /DiagnosticsService
   acl config_security url_beg -i /securityservice
   acl config_printer url_beg -i /Printerservice
   acl config_email url_beg -i /Emailservice
   acl config_publisher url_beg -i /Publisherservice
   acl config_fax url_beg -i /Faxservice
   acl config_dataprep url_beg -i /Dataprepservice
   acl config_opcclient url_beg -i /opcclientservice
   acl config_messaging url_beg -i /InstantMessaging
   acl config_workstation url_beg -i /WorkstationsMonitoringService
   acl config_arbritator url_beg -i /ArbitratorService
   acl config_sms url_beg -i /ServerMonitoringService
   acl hostname hdr(Host) -m dom -i ap-app-app.domain.local   
   acl ip_24 src 10.24.0.0/16
   acl ip_25 src 10.25.0.0/16
   acl ip_26 src 10.26.0.0/16   
   use_backend be24_app_app_system if ip_24 config_system  
   use_backend be25_app_app_system if ip_25 config_system
   use_backend be26_app_app_system if ip_26 config_system   
   use_backend be24_app_app_logging if ip_24 config_logging  
   use_backend be25_app_app_logging if ip_25 config_logging
   use_backend be26_app_app_logging if ip_26 config_logging   
   use_backend be24_app_app_diagnostics if ip_24 config_diagnostics 
   use_backend be25_app_app_diagnostics if ip_25 config_diagnostics 
   use_backend be26_app_app_diagnostics if ip_26 config_diagnostics 
   use_backend be24_app_app_security if ip_24 config_security   
   use_backend be25_app_app_security if ip_25 config_security
   use_backend be26_app_app_security if ip_26 config_security   
   use_backend be24_app_app_printer if ip_24 config_printer  
   use_backend be25_app_app_printer if ip_25 config_printer 
   use_backend be26_app_app_printer if ip_26 config_printer
   use_backend be24_app_app_email if ip_24 config_email 
   use_backend be25_app_app_email if ip_25 config_email  
   use_backend be26_app_app_email if ip_26 config_email
   use_backend be24_app_app_publisher if ip_24 config_publisher 
   use_backend be25_app_app_publisher if ip_25 config_publisher  
   use_backend be26_app_app_publisher if ip_26 config_publisher
   use_backend be24_app_app_fax if ip_24 config_fax  
   use_backend be25_app_app_fax if ip_25 config_fax  
   use_backend be26_app_app_fax if ip_26 config_fax
   use_backend be24_app_app_dataprep if ip_24 config_dataprep
   use_backend be25_app_app_dataprep if ip_25 config_dataprep 
   use_backend be26_app_app_dataprep if ip_26 config_dataprep
   use_backend be24_app_app_opcclient if ip_24 config_opcclient  
   use_backend be25_app_app_opcclient if ip_25 config_opcclient  
   use_backend be26_app_app_opcclient if ip_26 config_opcclient
   use_backend be24_app_app_messaging if ip_24 config_messaging 
   use_backend be25_app_app_messaging if ip_25 config_messaging  
   use_backend be26_app_app_messaging if ip_26 config_messaging
   use_backend be24_app_app_workstation if ip_24 config_workstation 
   use_backend be26_app_app_workstation if ip_26 config_workstation
   use_backend be25_app_app_workstation if ip_25 config_workstation 
   use_backend be24_app_app_arbritator if ip_24 config_arbritator 
   use_backend be25_app_app_arbritator if ip_25 config_arbritator  
   use_backend be26_app_app_arbritator if ip_26 config_arbritator
   use_backend be24_app_app_sms if ip_24 config_sms 
   use_backend be25_app_app_sms if ip_25 config_sms  
   use_backend be26_app_app_sms if ip_26 config_sms
   
backend be24_app_app_system
   balance source
   mode http
   option forwardfor
   http-check expect status 200
   option httpchk GET /systemConfigurationService/metadata "HTTP/1.1\r\nHost: ap-app-app.domain.local"
   server app-app1-system app-app1.domain.local:9080 check inter 3s weight 1 
   server app-app2-system app-app2.domain.local:9080 check inter 3s weight 2 
   server app-app1-system app-app1.domain.local:9080 check backup inter 3s weight 3 
   server app-app2-system app-app2.domain.local:9080 check backup inter 3s weight 4 

backend be25_app_app_system
   balance source
   mode http
   option forwardfor 
   http-check expect status 200
   option httpchk GET /systemConfigurationService/metadata "HTTP/1.1\r\nHost: ap-app-app.domain.local"  
   server app-app1-system app-app1.domain.local:9080 check inter 3s weight 1
   server app-app2-system app-app2.domain.local:9080 check inter 3s weight 2
   server app-app1-system app-app1.domain.local:9080 check backup inter 3s weight 3
   server app-app2-system app-app2.domain.local:9080 check backup inter 3s weight 4
   
backend be26_app_app_system
   balance source
   mode http
   option forwardfor
   http-check expect status 200
   option httpchk GET /systemConfigurationService/metadata "HTTP/1.1\r\nHost: ap-app-app.domain.local"
   server app-app1-system app-app1.domain.local:9080 check inter 3s weight 1 
   server app-app2-system app-app2.domain.local:9080 check inter 3s weight 2 
   server app-app1-system app-app1.domain.local:9080 check backup inter 3s weight 3 
   server app-app2-system app-app2.domain.local:9080 check backup inter 3s weight 4   

backend be24_app_app_logging
   balance source
   mode http
   option forwardfor
   http-check expect status 200
   option httpchk GET /LoggingService/metadata "HTTP/1.1\r\nHost: ap-app-app.domain.local"
   server app-app1-logging app-app1.domain.local:9080 check inter 3s weight 1
   server app-app2-logging app-app2.domain.local:9080 check inter 3s weight 2
   server app-app1-logging app-app1.domain.local:9080 check backup inter 3s weight 3
   server app-app2-logging app-app2.domain.local:9080 check backup inter 3s weight 4

backend be25_app_app_logging
   balance source
   mode http
   option forwardfor
   http-check expect status 200
   option httpchk GET /LoggingService/metadata "HTTP/1.1\r\nHost: ap-app-app.domain.local"
   server app-app1-logging app-app1.domain.local:9080 check inter 3s weight 1
   server app-app2-logging app-app2.domain.local:9080 check inter 3s weight 2
   server app-app1-logging app-app1.domain.local:9080 check backup inter 3s weight 3
   server app-app2-logging app-app2.domain.local:9080 check backup inter 3s weight 4

backend be26_app_app_logging
   balance source
   mode http
   option forwardfor
   http-check expect status 200
   option httpchk GET /LoggingService/metadata "HTTP/1.1\r\nHost: ap-app-app.domain.local"
   server app-app1-logging app-app1.domain.local:9080 check inter 3s weight 1
   server app-app2-logging app-app2.domain.local:9080 check inter 3s weight 2
   server app-app1-logging app-app1.domain.local:9080 check backup inter 3s weight 3
   server app-app2-logging app-app2.domain.local:9080 check backup inter 3s weight 4

backend be24_app_app_diagnostics
   balance source
   mode http
   option forwardfor
   http-check expect status 200
   option httpchk GET /DiagnosticsService/metadata "HTTP/1.1\r\nHost: ap-app-app.domain.local"
   server app-app1-diagnostics app-app1.domain.local:9080 check inter 3s weight 1
   server app-app2-diagnostics app-app2.domain.local:9080 check inter 3s weight 2
   server app-app1-diagnostics app-app1.domain.local:9080 check backup inter 3s weight 3
   server app-app2-diagnostics app-app2.domain.local:9080 check backup inter 3s weight 4

backend be25_app_app_diagnostics
   balance source
   mode http
   option forwardfor
   http-check expect status 200
   option httpchk GET /DiagnosticsService/metadata "HTTP/1.1\r\nHost: ap-app-app.domain.local"
   server app-app1-diagnostics app-app1.domain.local:9080 check inter 3s weight 1
   server app-app2-diagnostics app-app2.domain.local:9080 check inter 3s weight 2
   server app-app1-diagnostics app-app1.domain.local:9080 check backup inter 3s weight 3
   server app-app2-diagnostics app-app2.domain.local:9080 check backup inter 3s weight 4
   
backend be26_app_app_diagnostics
   balance source
   mode http
   option forwardfor
   http-check expect status 200
   option httpchk GET /DiagnosticsService/metadata "HTTP/1.1\r\nHost: ap-app-app.domain.local"
   server app-app1-diagnostics app-app1.domain.local:9080 check inter 3s weight 1
   server app-app2-diagnostics app-app2.domain.local:9080 check inter 3s weight 2
   server app-app1-diagnostics app-app1.domain.local:9080 check backup inter 3s weight 3
   server app-app2-diagnostics app-app2.domain.local:9080 check backup inter 3s weight 4   

backend be24_app_app_security
   balance source
   mode http
   option forwardfor
   http-check expect status 200
   option httpchk GET /securityservice/metadata "HTTP/1.1\r\nHost: ap-app-app.domain.local"
   server app-app1-security app-app1.domain.local:9080 check inter 3s weight 1
   server app-app2-security app-app2.domain.local:9080 check inter 3s weight 2
   server app-app1-security app-app1.domain.local:9080 check backup inter 3s weight 3
   server app-app2-security app-app2.domain.local:9080 check backup inter 3s weight 4

backend be25_app_app_security
   balance source
   mode http
   option forwardfor
   http-check expect status 200
   option httpchk GET /securityservice/metadata "HTTP/1.1\r\nHost: ap-app-app.domain.local"
   server app-app1-security app-app1.domain.local:9080 check inter 3s weight 1
   server app-app2-security app-app2.domain.local:9080 check inter 3s weight 2
   server app-app1-security app-app1.domain.local:9080 check backup inter 3s weight 3
   server app-app2-security app-app2.domain.local:9080 check backup inter 3s weight 4
   
backend be26_app_app_security
   balance source
   mode http
   option forwardfor
   http-check expect status 200
   option httpchk GET /securityservice/metadata "HTTP/1.1\r\nHost: ap-app-app.domain.local"
   server app-app1-security app-app1.domain.local:9080 check inter 3s weight 1
   server app-app2-security app-app2.domain.local:9080 check inter 3s weight 2
   server app-app1-security app-app1.domain.local:9080 check backup inter 3s weight 3
   server app-app2-security app-app2.domain.local:9080 check backup inter 3s weight 4   
   
backend be24_app_app_printer
   balance source
   mode http
   option forwardfor
   http-check expect status 200
   option httpchk GET /Printerservice/metadata "HTTP/1.1\r\nHost: ap-app-app.domain.local"
   server app-app1-printer app-app1.domain.local:9080 check inter 3s weight 1
   server app-app2-printer app-app2.domain.local:9080 check inter 3s weight 2
   server app-app1-printer app-app1.domain.local:9080 check backup inter 3s weight 3
   server app-app2-printer app-app2.domain.local:9080 check backup inter 3s weight 4

backend be25_app_app_printer
   balance source
   mode http
   option forwardfor
   http-check expect status 200
   option httpchk GET /Printerservice/metadata "HTTP/1.1\r\nHost: ap-app-app.domain.local"
   server app-app1-printer app-app1.domain.local:9080 check inter 3s weight 1
   server app-app2-printer app-app2.domain.local:9080 check inter 3s weight 2
   server app-app1-printer app-app1.domain.local:9080 check backup inter 3s weight 3
   server app-app2-printer app-app2.domain.local:9080 check backup inter 3s weight 4

backend be26_app_app_printer
   balance source
   mode http
   option forwardfor
   http-check expect status 200
   option httpchk GET /Printerservice/metadata "HTTP/1.1\r\nHost: ap-app-app.domain.local"
   server app-app1-printer app-app1.domain.local:9080 check inter 3s weight 1
   server app-app2-printer app-app2.domain.local:9080 check inter 3s weight 2
   server app-app1-printer app-app1.domain.local:9080 check backup inter 3s weight 3
   server app-app2-printer app-app2.domain.local:9080 check backup inter 3s weight 4   
   
backend be24_app_app_email
   balance source
   mode http
   option forwardfor
   http-check expect status 200
   option httpchk GET /Emailservice/metadata "HTTP/1.1\r\nHost: ap-app-app.domain.local"
   server app-app1-email app-app1.domain.local:9080 check inter 3s weight 1
   server app-app2-email app-app2.domain.local:9080 check inter 3s weight 2
   server app-app1-email app-app1.domain.local:9080 check backup inter 3s weight 3
   server app-app2-email app-app2.domain.local:9080 check backup inter 3s weight 4

backend be25_app_app_email
   balance source
   mode http
   option forwardfor
   http-check expect status 200
   option httpchk GET /Emailservice/metadata "HTTP/1.1\r\nHost: ap-app-app.domain.local"
   server app-app1-email app-app1.domain.local:9080 check inter 3s weight 1
   server app-app2-email app-app2.domain.local:9080 check inter 3s weight 2
   server app-app1-email app-app1.domain.local:9080 check backup inter 3s weight 3
   server app-app2-email app-app2.domain.local:9080 check backup inter 3s weight 4

backend be26_app_app_email
   balance source
   mode http
   option forwardfor
   http-check expect status 200
   option httpchk GET /Emailservice/metadata "HTTP/1.1\r\nHost: ap-app-app.domain.local"
   server app-app1-email app-app1.domain.local:9080 check inter 3s weight 1
   server app-app2-email app-app2.domain.local:9080 check inter 3s weight 2
   server app-app1-email app-app1.domain.local:9080 check backup inter 3s weight 3
   server app-app2-email app-app2.domain.local:9080 check backup inter 3s weight 4   
   
backend be24_app_app_publisher
   balance source
   mode http
   option forwardfor
   http-check expect status 200
   option httpchk GET /PublisherService/metadata "HTTP/1.1\r\nHost: ap-app-app.domain.local"
   server app-opc-publisher ap-app-opc.domain.local:9080 check inter 3s weight 1
   server app-bropc-publisher ap-app-bropc.domain.local:9080 check backup inter 3s weight 2


backend be25_app_app_publisher
   balance source
   mode http
   option forwardfor
   http-check expect status 200
   option httpchk GET /PublisherService/metadata "HTTP/1.1\r\nHost: ap-app-app.domain.local"
   server app-opc-publisher ap-app-bropc.domain.local:9080 check inter 3s weight 1
   server app-bropc-publisher ap-app-opc.domain.local:9080 check backup inter 3s weight 2


backend be26_app_app_publisher
   balance source
   mode http
   option forwardfor
   http-check expect status 200
   option httpchk GET /PublisherService/metadata "HTTP/1.1\r\nHost: ap-app-app.domain.local"
   server app-opc-publisher ap-app-opc.domain.local:9080 check inter 3s weight 1
   server app-bropc-publisher ap-app-bropc.domain.local:9080 check backup inter 3s weight 2    

backend be24_app_app_fax
   balance source
   mode http
   option forwardfor
   http-check expect status 200
   option httpchk GET /Faxservice/metadata "HTTP/1.1\r\nHost: ap-app-app.domain.local"
   server app-app1-fax app-app1.domain.local:9080 check inter 3s weight 1
   server app-app2-fax app-app2.domain.local:9080 check inter 3s weight 2
   server app-app1-fax app-app1.domain.local:9080 check backup inter 3s weight 3
   server app-app2-fax app-app2.domain.local:9080 check backup inter 3s weight 4

backend be25_app_app_fax
   balance source
   mode http
   option forwardfor
   http-check expect status 200
   option httpchk GET /Faxservice/metadata "HTTP/1.1\r\nHost: ap-app-app.domain.local"
   server app-app1-fax app-app1.domain.local:9080 check inter 3s weight 1
   server app-app2-fax app-app2.domain.local:9080 check inter 3s weight 2
   server app-app1-fax app-app1.domain.local:9080 check backup inter 3s weight 3
   server app-app2-fax app-app2.domain.local:9080 check backup inter 3s weight 4
   
backend be26_app_app_fax
   balance source
   mode http
   option forwardfor
   http-check expect status 200
   option httpchk GET /Faxservice/metadata "HTTP/1.1\r\nHost: ap-app-app.domain.local"
   server app-app1-fax app-app1.domain.local:9080 check inter 3s weight 1
   server app-app2-fax app-app2.domain.local:9080 check inter 3s weight 2
   server app-app1-fax app-app1.domain.local:9080 check backup inter 3s weight 3
   server app-app2-fax app-app2.domain.local:9080 check backup inter 3s weight 4   

backend be24_app_app_dataprep
   balance source
   mode http
   option forwardfor
   http-check expect status 200
   option httpchk GET /Dataprepservice/metadata "HTTP/1.1\r\nHost: ap-app-app.domain.local"
   server app-app1-dataprep app-app1.domain.local:9080 check inter 3s weight 1
   server app-app2-dataprep app-app2.domain.local:9080 check inter 3s weight 2
   server app-app1-dataprep app-app1.domain.local:9080 check backup inter 3s weight 3
   server app-app2-dataprep app-app2.domain.local:9080 check backup inter 3s weight 4

backend be25_app_app_dataprep
   balance source
   mode http
   option forwardfor
   http-check expect status 200
   option httpchk GET /Dataprepservice/metadata "HTTP/1.1\r\nHost: ap-app-app.domain.local"
   server app-app1-dataprep app-app1.domain.local:9080 check inter 3s weight 1
   server app-app2-dataprep app-app2.domain.local:9080 check inter 3s weight 2
   server app-app1-dataprep app-app1.domain.local:9080 check backup inter 3s weight 3
   server app-app2-dataprep app-app2.domain.local:9080 check backup inter 3s weight 4

backend be26_app_app_dataprep
   balance source
   mode http
   option forwardfor
   http-check expect status 200
   option httpchk GET /Dataprepservice/metadata "HTTP/1.1\r\nHost: ap-app-app.domain.local"
   server app-app1-dataprep app-app1.domain.local:9080 check inter 3s weight 1
   server app-app2-dataprep app-app2.domain.local:9080 check inter 3s weight 2
   server app-app1-dataprep app-app1.domain.local:9080 check backup inter 3s weight 3
   server app-app2-dataprep app-app2.domain.local:9080 check backup inter 3s weight 4  
   
backend be24_app_app_opcclient
   balance source
   mode http
   option forwardfor
   http-check expect status 200
   option httpchk GET /opcclientservice/metadata "HTTP/1.1\r\nHost: ap-app-app.domain.local"
   server app-app1-opcclient app-app1.domain.local:9080 check inter 3s weight 1
   server app-app2-opcclient app-app2.domain.local:9080 check inter 3s weight 2
   server app-app1-opcclient app-app1.domain.local:9080 check backup inter 3s weight 3
   server app-app2-opcclient app-app2.domain.local:9080 check backup inter 3s weight 4

backend be25_app_app_opcclient
   balance source
   mode http
   option forwardfor
   http-check expect status 200
   option httpchk GET /opcclientservice/metadata "HTTP/1.1\r\nHost: ap-app-app.domain.local"
   server app-app1-opcclient app-app1.domain.local:9080 check inter 3s weight 1
   server app-app2-opcclient app-app2.domain.local:9080 check inter 3s weight 2
   server app-app1-opcclient app-app1.domain.local:9080 check backup inter 3s weight 3
   server app-app2-opcclient app-app2.domain.local:9080 check backup inter 3s weight 4

backend be26_app_app_opcclient
   balance source
   mode http
   option forwardfor
   http-check expect status 200
   option httpchk GET /opcclientservice/metadata "HTTP/1.1\r\nHost: ap-app-app.domain.local"
   server app-app1-opcclient app-app1.domain.local:9080 check inter 3s weight 1
   server app-app2-opcclient app-app2.domain.local:9080 check inter 3s weight 2
   server app-app1-opcclient app-app1.domain.local:9080 check backup inter 3s weight 3
   server app-app2-opcclient app-app2.domain.local:9080 check backup inter 3s weight 4

backend be24_app_app_messaging
   balance source
   mode http
   option forwardfor
   http-check expect status 200
   option httpchk GET /InstantMessaging/metadata "HTTP/1.1\r\nHost: ap-app-app.domain.local"
   server app-app1-messaging app-app1.domain.local:9080 check inter 3s weight 1
   server app-app2-messaging app-app2.domain.local:9080 check inter 3s weight 2
   server app-app1-messaging app-app1.domain.local:9080 check backup inter 3s weight 3
   server app-app2-messaging app-app2.domain.local:9080 check backup inter 3s weight 4

backend be25_app_app_messaging
   balance source
   mode http
   option forwardfor
   http-check expect status 200
   option httpchk GET /InstantMessaging/metadata "HTTP/1.1\r\nHost: ap-app-app.domain.local"
   server app-app1-messaging app-app1.domain.local:9080 check inter 3s weight 1
   server app-app2-messaging app-app2.domain.local:9080 check inter 3s weight 2
   server app-app1-messaging app-app1.domain.local:9080 check backup inter 3s weight 3
   server app-app2-messaging app-app2.domain.local:9080 check backup inter 3s weight 4

backend be26_app_app_messaging
   balance source
   mode http
   option forwardfor
   http-check expect status 200
   option httpchk GET /InstantMessaging/metadata "HTTP/1.1\r\nHost: ap-app-app.domain.local"
   server app-app1-messaging app-app1.domain.local:9080 check inter 3s weight 1
   server app-app2-messaging app-app2.domain.local:9080 check inter 3s weight 2
   server app-app1-messaging app-app1.domain.local:9080 check backup inter 3s weight 3
   server app-app2-messaging app-app2.domain.local:9080 check backup inter 3s weight 4

backend be24_app_app_workstation
   balance source
   mode http
   option forwardfor
   option httpchk GET /WorkstationsMonitoringService/metadata "HTTP/1.1\r\nHost: ap-app-app.domain.local" 
   server app-app1-workstation app-app1.domain.local:9080 check inter 3s weight 1
   server app-app2-workstation app-app2.domain.local:9080 check inter 3s weight 2
   server app-app1-workstation app-app1.domain.local:9080 check backup inter 3s weight 3
   server app-app2-workstation app-app2.domain.local:9080 check backup inter 3s weight 4

backend be25_app_app_workstation
   balance source
   mode http
   option forwardfor
   option httpchk GET /WorkstationsMonitoringService/metadata "HTTP/1.1\r\nHost: ap-app-app.domain.local" 
   server app-app1-workstation app-app1.domain.local:9080 check inter 3s weight 1
   server app-app2-workstation app-app2.domain.local:9080 check inter 3s weight 2
   server app-app1-workstation app-app1.domain.local:9080 check backup inter 3s weight 3
   server app-app2-workstation app-app2.domain.local:9080 check backup inter 3s weight 4

backend be26_app_app_workstation
   balance source
   mode http
   option forwardfor
   option httpchk GET /WorkstationsMonitoringService/metadata "HTTP/1.1\r\nHost: ap-app-app.domain.local" 
   server app-app1-workstation app-app1.domain.local:9080 check inter 3s weight 1
   server app-app2-workstation app-app2.domain.local:9080 check inter 3s weight 2
   server app-app1-workstation app-app1.domain.local:9080 check backup inter 3s weight 3
   server app-app2-workstation app-app2.domain.local:9080 check backup inter 3s weight 4

backend be24_app_app_arbritator
   balance source
   mode http
   option forwardfor
   http-check expect status 200
   option httpchk GET /ArbitratorService/metadata "HTTP/1.1\r\nHost: ap-app-app.domain.local"
   server app-app1-arbritator app-app1.domain.local:9080 check inter 3s weight 1
   server app-app2-arbritator app-app2.domain.local:9080 check inter 3s weight 2
   server app-app1-arbritator app-app1.domain.local:9080 check backup inter 3s weight 3
   server app-app2-arbritator app-app2.domain.local:9080 check backup inter 3s weight 4

backend be25_app_app_arbritator
   balance source
   mode http
   option forwardfor
   http-check expect status 200
   option httpchk GET /ArbitratorService/metadata "HTTP/1.1\r\nHost: ap-app-app.domain.local"
   server app-app1-arbritator app-app1.domain.local:9080 check inter 3s weight 1
   server app-app2-arbritator app-app2.domain.local:9080 check inter 3s weight 2
   server app-app1-arbritator app-app1.domain.local:9080 check backup inter 3s weight 3
   server app-app2-arbritator app-app2.domain.local:9080 check backup inter 3s weight 4

backend be26_app_app_arbritator
   balance source
   mode http
   option forwardfor
   http-check expect status 200
   option httpchk GET /ArbitratorService/metadata "HTTP/1.1\r\nHost: ap-app-app.domain.local"
   server app-app1-arbritator app-app1.domain.local:9080 check inter 3s weight 1
   server app-app2-arbritator app-app2.domain.local:9080 check inter 3s weight 2
   server app-app1-arbritator app-app1.domain.local:9080 check backup inter 3s weight 3
   server app-app2-arbritator app-app2.domain.local:9080 check backup inter 3s weight 4

backend be24_app_app_sms
   balance source
   mode http
   option forwardfor
   http-check expect status 200
   option httpchk GET /ServerMonitoringService/metadata "HTTP/1.1\r\nHost: ap-app-app.domain.local"
   server app-app1-sms app-app1.domain.local:9080 check inter 3s weight 1
   server app-app2-sms app-app2.domain.local:9080 check inter 3s weight 2
   server app-app1-sms app-app1.domain.local:9080 check backup inter 3s weight 3
   server app-app2-sms app-app2.domain.local:9080 check backup inter 3s weight 4

backend be25_app_app_sms
   balance source
   mode http
   option forwardfor
   http-check expect status 200
   option httpchk GET /ServerMonitoringService/metadata "HTTP/1.1\r\nHost: ap-app-app.domain.local"
   server app-app1-sms app-app1.domain.local:9080 check inter 3s weight 1
   server app-app2-sms app-app2.domain.local:9080 check inter 3s weight 2
   server app-app1-sms app-app1.domain.local:9080 check backup inter 3s weight 3
   server app-app2-sms app-app2.domain.local:9080 check backup inter 3s weight 4

backend be26_app_app_sms
   balance source
   mode http
   option forwardfor
   http-check expect status 200
   option httpchk GET /ServerMonitoringService/metadata "HTTP/1.1\r\nHost: ap-app-app.domain.local"
   server app-app1-sms app-app1.domain.local:9080 check inter 3s weight 1
   server app-app2-sms app-app2.domain.local:9080 check inter 3s weight 2
   server app-app1-sms app-app1.domain.local:9080 check backup inter 3s weight 3
   server app-app2-sms app-app2.domain.local:9080 check backup inter 3s weight 4   
############################################################################################# 

######################### Stats configuration #########################
listen stats													
   bind 10.26.141.110:1936 ssl crt /etc/haproxy/ssl/haproxycert.pem
   stats enable
   stats admin if TRUE
   stats uri /stats
   stats hide-version
   stats realm Haproxy\ Statistics
   stats auth admin:1050
#########################################################################   
